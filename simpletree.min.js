var STree=function(el,nodeData,options){function offset(el){var rect=el.getBoundingClientRect(),scrollLeft=window.pageXOffset||document.documentElement.scrollLeft,scrollTop=window.pageYOffset||document.documentElement.scrollTop;return{top:rect.top+scrollTop,left:rect.left+scrollLeft}}this.container=el,this.list=null,this.nodes=nodeData,this.options=options,this.eventListeners={},this.draggedNode=null,this.pathAttribute="label",this.pathSeparator="/",this.LIST_TAG="ul",this.LIST_ITEM_TAG="li",this.LIST_LABEL_TAG="div",this.LIST_LABEL_EXPAND_TAG="span",this.LIST_LABEL_TEXT_TAG="span",this.LIST_ICON_TAG="span",this.LIST_FOLDER_LINE_TAG="div",this.LIST_ITEM_LINE_TAG="div",this.LIST_ITEM_EDIT_TAG="input",this.LIST_ITEM_HIGHLIGHT_TAG="div",this.LIST_FOLDER_EXPANDED="&#x203A;",this.LIST_FOLDER_COLLAPSED="&#x203A;",this.EVENT_ITEM_SELECT="stree-item-select",this.EVENT_ITEM_MOVE="stree-item-move",this.EVENT_ITEM_ADD="stree-item-add",this.EVENT_ITEM_REMOVE="stree-item-remove",this.EVENT_ITEM_CHANGE="stree-item-change",this.EVENT_FOLDER_EXPAND="stree-folder-expand",this.EVENT_ITEM_DRAGOVER="stree-item-dragover",this.clear=function(){this.container.innerHTML=""},this.addEventListener=function(eventKey,listener){this.eventListeners[eventKey]||(this.eventListeners[eventKey]=[]),this.eventListeners[eventKey].push(listener)},this.sendEvent=function(eventKey,eventObj){var listeners=this.eventListeners[eventKey];if(listeners&&listeners.length>0)for(var lIdx=0;lIdx<listeners.length;lIdx++)listeners[lIdx].call(this,eventObj)},this.onNodeExpanded=function(node){var eventObj={type:this.EVENT_FOLDER_EXPAND,node:node};this.sendEvent(this.EVENT_FOLDER_EXPAND,eventObj)},this.onNodeSelected=function(node){var eventObj={type:this.EVENT_ITEM_SELECT,node:node};this.sendEvent(this.EVENT_ITEM_SELECT,eventObj)},this.onNodeMoved=function(node,oldPath,newPath){var eventObj={type:this.EVENT_ITEM_MOVE,node:node,oldPath:oldPath,newPath:newPath};this.sendEvent(this.EVENT_ITEM_MOVE,eventObj)},this.onNodeAdd=function(node){var eventObj={type:this.EVENT_ITEM_ADD,node:node};this.sendEvent(this.EVENT_ITEM_ADD,eventObj)},this.onNodeRemove=function(node,oldParent){var eventObj={type:this.EVENT_ITEM_REMOVE,node:node,oldParent:oldParent};this.sendEvent(this.EVENT_ITEM_REMOVE,eventObj)},this.onNodeChange=function(node,oldValue,newValue){var eventObj={type:this.EVENT_ITEM_CHANGE,node:stree.editedNode,oldValue:oldValue,newValue:newValue};stree.sendEvent(this.EVENT_ITEM_CHANGE,eventObj)},this.onDragOver=function(node,draggedNode){var eventObj={type:this.EVENT_ITEM_DRAGOVER,node:node,draggedNode:draggedNode},listeners;return this.eventListeners[this.EVENT_ITEM_DRAGOVER][0].call(this,eventObj)},this.getNewId=function(length){var idPrefix;return(this.container.id?this.container.id+"-":"")+"stree-"+Math.round(Math.pow(36,length+1)-Math.random()*Math.pow(36,length)).toString(36).slice(1)},this.expandNode=function(node){node.expanded=!0,node.listEl&&node.listEl.classList.add("stree-list-expanded"),node.expandEl.innerHTML=this.LIST_FOLDER_EXPANDED,node.expandEl.classList.add("expanded")},this.collapseNode=function(node){node.expanded=!1,node.listEl&&node.listEl.classList.remove("stree-list-expanded"),node.expandEl.innerHTML=this.LIST_FOLDER_COLLAPSED,node.expandEl.classList.remove("expanded")},this.getOnNodeExpandListener=function(node,stree){return function(e){if(node.expanded)stree.collapseNode(node);else{if(stree.options.lazyLoad&&!node.listEl)for(var childIdx=0;childIdx<node.children.length;childIdx++){var childNode=node.children[childIdx];stree.createNode(childNode,node)}stree.expandNode(node)}stree.onNodeExpanded.call(stree,node)}},this.addNodeExpand=function(node,nodeElem,labelElem){var expandElem=document.createElement(this.LIST_LABEL_EXPAND_TAG);expandElem.classList.add("stree-item-expand"),!0===node.folder?(expandElem.classList.add("stree-item-folder"),expandElem.innerHTML=this.LIST_FOLDER_COLLAPSED,node.onExpand||(node.onExpand=this.getOnNodeExpandListener(node,this)),expandElem.addEventListener("click",node.onExpand)):(expandElem.classList.add("stree-item-default"),expandElem.innerHTML=""),node.expandEl=expandElem,labelElem.appendChild(expandElem)},this.nodeExists=function(node,parentNode){if(!parentNode||!parentNode.folder||!parentNode.isRoot&&!parentNode.children)return!1;for(var children=parentNode.children,exists=!1,cIdx=0;cIdx<children.length&&!(exists=node.label===children[cIdx].label);cIdx++);return exists},this.removeNode=function(node,childNode){var rVal=!1;if(node.children&&node.children.length>0)for(var cIdx=0;cIdx<node.children.length;cIdx++){var cNode=node.children[cIdx];if(cNode.id===childNode.id){node.children.splice(cIdx,1),node.listEl.removeChild(cNode.el),rVal=!0;break}}return 0===node.children.length&&(node.el.removeChild(node.listEl),delete node.listEl,node.expandEl.removeEventListener("click",node.onExpand),delete node.onExpand,node.expandEl.classList.remove("stree-item-folder"),node.expandEl.classList.add("stree-item-default"),node.expandEl.innerHTML="",node.iconEl&&(node.iconEl.innerHTML=Icon.get("FILE_ICON")),node.folderLineEl&&(node.el.removeChild(node.folderLineEl),delete node.folderLineEl)),this.onNodeRemove(childNode,node),rVal},this.removeNodeById=function(idStr){var node=this.getNodeById(idStr);return!!node&&this.removeNode(node.parent,node)},this.getNodeById=function(idStr,startNode){var node=startNode||this.nodes;if(node.id===idStr)return node;if(!(node.children&&node.children.length>0))return null;for(var cIdx=0;cIdx<node.children.length;cIdx++)if(cNode=this.getNodeById(idStr,node.children[cIdx]),cNode)return cNode},this.getNodePath=function(node,full){for(var currNode=node,path=full?this.pathSeparator+node.label:"";!currNode.isRoot;)path=this.pathSeparator+currNode.parent.label+path,currNode=currNode.parent;return path},this.moveNodeTo=function(node,targetNode){if(node&&targetNode){var oldPath=this.getNodePath(node),currParent=node.parent;this.removeNode(currParent,node),node.parent=targetNode,targetNode.children||(targetNode.children=[]),targetNode.children.push(node),targetNode.listEl||(targetNode.listEl=this.getNodeList(targetNode.parent),targetNode.el.appendChild(targetNode.listEl),targetNode.expandEl.classList.remove("stree-item-default"),targetNode.expandEl.classList.add("stree-item-folder"),targetNode.expandEl.innerHTML=this.LIST_FOLDER_COLLAPSED,targetNode.onExpand||(targetNode.onExpand=this.getOnNodeExpandListener(targetNode,this)),targetNode.expandEl.addEventListener("click",targetNode.onExpand),targetNode.iconEl&&(targetNode.iconEl.innerHTML=Icon.get("FOLDER_ICON")),this.addFolderLine(targetNode,targetNode.el)),targetNode.listEl.appendChild(node.el);var newPath=this.getNodePath(node);this.onNodeMoved(node,oldPath,newPath)}},this.expandNodePath=function(node){node.children&&node.children.length>0&&this.expandNode(node),node.parent&&this.expandNodePath(node.parent)},this.selectNode=function(node){this._selectNode(node),this.expandNodePath(node)},this.unselectNode=function(){var currSelected=this.selectedNode;currSelected&&(currSelected.selected=!1,currSelected.el.classList.remove("selected"),currSelected.labelEl.classList.remove("stree-item-selected"),delete this.selectedNode,this.selectHighlightEl.parentElement&&this.selectHighlightEl.parentElement.removeChild(this.selectHighlightEl))},this._selectNode=function(node,e){if(this.isEditMode&&(this.resetEditMode(),this.editedNode.labelTextEl.innerHTML=this.editedNode.label,this.editedNode=null),!(e&&e.srcElement.classList.contains("stree-item-expand")||(e&&!0===node.folder&&node.onExpand&&node.onExpand.call(this,e),this.selectedNode&&this.selectedNode.id===node.id))){this.unselectNode(),node.selected=!0,node.el.classList.add("selected"),node.labelEl.classList.add("stree-item-selected");var scrollLeft=this.container.scrollLeft>0?this.container.scrollLeft-12:0;this.selectHighlightEl.style.left=-8*(node.level+1)+scrollLeft+"px",this.selectHighlightEl.classList.add("selected"),node.el.appendChild(this.selectHighlightEl),this.selectedNode=node,this.onNodeSelected(node)}},this.getOnSelectListener=function(node,stree){return function(e){stree._selectNode.call(stree,node,e)}},this.getOnMouseOverListener=function(node,stree){return function(e){if(e.srcElement.classList.contains("stree-item-label")||e.srcElement.classList.contains("stree-item-expand")||e.srcElement.classList.contains("stree-item-label-text")||e.srcElement.classList.contains("stree-item-edit")){node.el.classList.add("hover"),node.labelTextEl.classList.add("hover"),stree.highlightEl.parentElement&&stree.highlightEl.parentElement.removeChild(stree.highlightEl);var scrollLeft=stree.container.scrollLeft>0?stree.container.scrollLeft-12:0;stree.highlightEl.style.left=-8*(node.level+1)+scrollLeft+"px",node.el.appendChild(stree.highlightEl),stree.highlightEl.classList.add("show")}}},this.getOnMouseOutListener=function(node,stree){return function(e){(e.srcElement.classList.contains("stree-item-label")||e.srcElement.classList.contains("stree-item-expand")||e.srcElement.classList.contains("stree-item-label-text")||e.srcElement.classList.contains("stree-item-edit"))&&(node.el.classList.remove("hover"),node.labelTextEl.classList.remove("hover"),stree.highlightEl.classList.remove("show"))}},this.getOnDragListener=function(node,stree){return function(e){stree.draggedNode=node}},this.getOnDragOverListener=function(node,stree){return function(e){if(node.allowDrop&&node.id!=stree.draggedNode.id&&stree.onDragOver(node,stree.draggedNode))return node.children&&node.children.length>0&&!node.expanded&&stree.expandNode(node),void e.preventDefault()}},this.getOnDropListener=function(node,stree){return function(e){stree.draggedNode.parent.id!=node.id&&stree.draggedNode.id!=node.id&&stree.moveNodeTo(stree.draggedNode,node),stree.draggedNode=null}},this.getContextMenuListener=function(node,stree){return function(e){stree.contextMenu&&(stree.contextMenu.visible&&stree.contextMenu.hideMenu(),stree.ctxNode=node,node.contextMenu&&node.contextMenu.items?stree.contextMenu.refreshMenu(node.contextMenu.override,node.contextMenu.items):stree.contextMenu.refreshMenu(!1),stree.contextMenu.showMenu(e.clientX,e.clientY,{ctxNode:stree.ctxNode}),e.preventDefault())}},this.resetEditMode=function(){this.nodeEditorEl.removeEventListener("change",this.editedNode.changeListener),delete this.editedNode.changeListener,this.editedNode.labelTextEl.removeChild(this.nodeEditorEl),this.editHighlightEl.parentElement&&this.editHighlightEl.parentElement.removeChild(this.editHighlightEl),this.editHighlightEl.classList.remove("edit"),this.isEditMode=!1},this.getOnEditListener=function(stree){return function(e){stree.resetEditMode();var oldValue=stree.editedNode.label,newValue=e.currentTarget.value;stree.editedNode.label=newValue,stree.editedNode.labelEl.setAttribute("title",newValue),stree.editedNode.labelTextEl.innerHTML=newValue,stree.editedNode.labelEl.classList.remove("edit"),stree.onNodeChange.call(stree,stree.editedNode,oldValue,newValue),stree.editedNode=null}},this.editNode=function(node){this.isEditMode=!0,this.editedNode=node,this.editedNode.changeListener=this.getOnEditListener(this),this.nodeEditorEl.value=node.label,this.nodeEditorEl.addEventListener("change",this.editedNode.changeListener),node.labelEl.classList.add("edit"),node.labelTextEl.innerHTML="",node.labelTextEl.appendChild(this.nodeEditorEl),this.nodeEditorEl.focus(),this.editHighlightEl.parentElement&&this.editHighlightEl.parentElement.removeChild(this.editHighlightEl);var scrollLeft=this.container.scrollLeft>0?this.container.scrollLeft-12:0;this.editHighlightEl.style.left=-8*(node.level+1)+scrollLeft+"px",this.editHighlightEl.classList.add("edit"),node.el.appendChild(this.editHighlightEl)},this.getNodeEditHandler=function(stree){return function(){stree.isEditMode=!0,stree.editedNode=this,stree.editedNode.changeListener=stree.getOnEditListener(stree),stree.nodeEditorEl.value=this.label,stree.nodeEditorEl.addEventListener("change",stree.editedNode.changeListener),this.labelEl.classList.add("edit"),this.labelTextEl.innerHTML="",this.labelTextEl.appendChild(stree.nodeEditorEl)}},this.addNodeIcon=function(node,labelElem){var iconElem=document.createElement(this.LIST_ICON_TAG);iconElem.classList.add("stree-item-icon"),!0===node.folder?iconElem.innerHTML=Icon.get("FOLDER_ICON"):iconElem.innerHTML=Icon.get("FILE_ICON"),labelElem.appendChild(iconElem),node.iconEl=iconElem},this.addNodeLabel=function(node,nodeElem){var labelElem=document.createElement(this.LIST_LABEL_TAG);labelElem.classList.add("stree-item-label"),this.addNodeExpand(node,nodeElem,labelElem),this.options.useIcon&&this.addNodeIcon(node,labelElem);var textElem=document.createElement(this.LIST_LABEL_TEXT_TAG);textElem.classList.add("stree-item-label-text"),node.labelTextEl=textElem,node.label&&(textElem.innerHTML=node.label,labelElem.setAttribute("title",node.label)),labelElem.appendChild(textElem),node.onSelect=this.getOnSelectListener(node,this),labelElem.addEventListener("click",node.onSelect),node.onMouseOver=this.getOnMouseOverListener(node,this),labelElem.addEventListener("mouseover",node.onMouseOver),node.onMouseOut=this.getOnMouseOutListener(node,this),labelElem.addEventListener("mouseout",node.onMouseOut),this.options.allowDrag&&(node.isRoot||(labelElem.setAttribute("draggable",!0),node.onDrag=this.getOnDragListener(node,this),labelElem.addEventListener("dragstart",node.onDrag)),node.onDrop=this.getOnDropListener(node,this),labelElem.addEventListener("drop",node.onDrop),node.onDragOver=this.getOnDragOverListener(node,this),labelElem.addEventListener("dragover",node.onDragOver)),this.contextMenu&&labelElem.addEventListener("contextmenu",this.getContextMenuListener(node,this)),node.labelEl=labelElem,nodeElem.appendChild(labelElem)},this.addFolderLine=function(node,nodeElem){if(this.options.folderLines&&!node.folderLineEl){var flElem=document.createElement(this.LIST_FOLDER_LINE_TAG);flElem.classList.add("stree-folder-line"),nodeElem.appendChild(flElem),node.folderLineEl=flElem}},this.addNodeElem=function(parent,node,tag,id,classList,level){var nodeElem=document.createElement(tag);nodeElem.setAttribute("id",id);for(var classIdx=0;classIdx<classList.length;classIdx++)nodeElem.classList.add(classList[classIdx]);return node&&(!0===node.folder&&this.addFolderLine(node,nodeElem),this.addNodeLabel(node,nodeElem)),parent.el?parent.el.appendChild(nodeElem):parent.appendChild(nodeElem),nodeElem},this.getNodeList=function(parent){var listElem;return this.addNodeElem(parent,null,this.LIST_TAG,this.getNewId(5),["stree-list"],0)},this.createRootNode=function(node){this.container.classList.add("stree"),node.isRoot=!0,this.list=this.getNodeList(this.container),this.list.classList.add("stree-list-root"),node.parent=null,node.id=this.getNewId(5),node.level=0,node.el=this.addNodeElem(this.list,node,this.LIST_ITEM_TAG,node.id,["stree-list-item"],node.level)},this.addNode=function(node,parentNode){parentNode.children||(parentNode.children=[]),parentNode.children.push(node),this.createNode(node,parentNode),this.onNodeAdd(node)},this.createChildNode=function(node,parentNode){parentNode.listEl||(parentNode.listEl=this.getNodeList(parentNode),parentNode.el.appendChild(parentNode.listEl),parentNode.expandEl.classList.remove("stree-item-default"),parentNode.expandEl.classList.add("stree-item-folder"),parentNode.expandEl.innerHTML=this.LIST_FOLDER_COLLAPSED,parentNode.onExpand||(parentNode.onExpand=this.getOnNodeExpandListener(parentNode,this)),parentNode.expandEl.addEventListener("click",parentNode.onExpand),parentNode.iconEl&&(parentNode.iconEl.innerHTML=Icon.get("FOLDER_ICON")),this.addFolderLine(parentNode,parentNode.el)),node.isRoot=!1,node.parent=parentNode,node.id=this.getNewId(5),node.level=parentNode.level+1,node.el=this.addNodeElem(parentNode.listEl,node,this.LIST_ITEM_TAG,node.id,["stree-list-item"],node.level)},this.createHighLighters=function(){var hlElem=document.createElement(this.LIST_ITEM_HIGHLIGHT_TAG);hlElem.classList.add("stree-item-highlight"),hlElem.style.width=this.container.offsetWidth-2+"px",this.container.appendChild(hlElem),this.highlightEl=hlElem;var sHlElem=document.createElement(this.LIST_ITEM_HIGHLIGHT_TAG);sHlElem.classList.add("stree-item-highlight"),sHlElem.style.width=this.container.offsetWidth-2+"px",this.container.appendChild(sHlElem),this.selectHighlightEl=sHlElem;var editHlElem=document.createElement(this.LIST_ITEM_HIGHLIGHT_TAG);editHlElem.classList.add("stree-item-highlight"),editHlElem.style.width=this.container.offsetWidth-2+"px",this.container.appendChild(editHlElem),this.editHighlightEl=editHlElem},this.createNode=function(node,parentNode){if(node.expanded=!1,parentNode?this.createChildNode(node,parentNode):this.createRootNode(node),(!0===node.folder||node.children&&node.children.length>0)&&(node.folder=!0,!this.options.lazyLoad))for(var childIdx=0;childIdx<node.children.length;childIdx++){var childNode=node.children[childIdx];this.createNode(childNode,node)}},this.getHideMenuHandler=function(stree){return function(e){if(!(e.srcElement.classList.contains("stree-list-item")||e.srcElement.classList.contains("stree-item-label")||e.srcElement.classList.contains("stree-item-expand")||e.srcElement.classList.contains("stree-item-label-text")))return!0;var nodeElem=null;return"DIV"===e.srcElement.tagName.toUpperCase()?nodeElem=e.srcElement.parentElement:e.srcElement.tagName.toUpperCase&&(nodeElem=e.srcElement.parentElement.parentElement),!nodeElem||nodeElem.id!==stree.ctxNode.id}},this.addContextMenu=function(ctxMenu){ctxMenu||(ctxMenu={}),ctxMenu.id||(ctxMenu.id=this.getNewId(5)),this.contextMenu=new SContext(ctxMenu),this.contextMenu.addHideMenuHandler(this.getHideMenuHandler(this));for(var nodeLabelElems=document.querySelectorAll("#"+this.container.id+" .stree-item-label"),nIdx=0;nIdx<nodeLabelElems.length;nIdx++){var labelElem=nodeLabelElems[nIdx],node=this.getNodeById(labelElem.parentElement.id);labelElem.addEventListener("contextmenu",this.getContextMenuListener(node,this))}},this.getOnEditEscListener=function(stree){return function(e){switch(e.key){case"Escape":stree.isEditMode&&(stree.resetEditMode(),stree.editedNode.labelTextEl.innerHTML=stree.editedNode.label,stree.editedNode=null)}}},this.addNodeEditor=function(){var nodeEditorElem=document.createElement(this.LIST_ITEM_EDIT_TAG);nodeEditorElem.setAttribute("type","text"),nodeEditorElem.classList.add("stree-item-edit"),nodeEditorElem.addEventListener("keydown",this.getOnEditEscListener(this)),this.nodeEditorEl=nodeEditorElem},this.getOnScrollListener=function(stree){return function(e){var scrollLeft=stree.container.scrollLeft-(stree.container.scrollHeight>stree.container.clientHeight?12:0);if(stree.isEditMode){var leftPos=-8*(stree.editedNode.level+1)+scrollLeft+"px";stree.editHighlightEl.style.left=leftPos}if(stree.selectedNode){var leftPos=-8*(stree.selectedNode.level+1)+scrollLeft+"px";stree.selectHighlightEl.style.left=leftPos}stree.highlightEl.classList.contains("show")&&stree.highlightEl.classList.remove("show")}},this.addScrollHandler=function(){this.scrollHandler=this.getOnScrollListener(this),this.container.addEventListener("scroll",this.scrollHandler)},this.processOptions=function(){this.options?this.addContextMenu(this.options.contextMenu):this.options={}},this.createTree=function(){this.processOptions(),this.createHighLighters(),this.createNode(this.nodes),this.addNodeEditor(),this.addScrollHandler()},this.createTree()},SContext=function(menu,options){function isFunction(functionToCheck){return functionToCheck&&"[object Function]"==={}.toString.call(functionToCheck)}this.menu=menu,this.menuEl=null,this.hideMenuHandlers=[],this.addHideMenuHandler=function(handler){this.hideMenuHandlers.push(handler)},this.windowClickListener=function(menu){return function(e){if(menu.visible){for(var hIdx=0;hIdx<menu.hideMenuHandlers.length;hIdx++)if(!menu.hideMenuHandlers[hIdx].call(menu,e))return;var classList=e.srcElement.classList;classList.contains("stree-ctxmenu")||classList.contains("stree-ctxmenu-item")||classList.contains("stree-ctxmenu-line")||menu.visible&&menu.hideMenu()}}},this.onMenuclick=function(menu,menuClickHandler){return function(e){menu.hideMenu(),menuClickHandler.call(menu,e)}},this.showMenu=function(posX,posY,options){this.visible||0===this.menu.items.length||(this.menuTriggerOptions=options,this.menuEl.style.left=posX+"px",this.menuEl.style.top=posY+"px",this.menuEl.classList.add("show"),this.visible=!0)},this.hideMenu=function(){this.visible&&(this.menuEl.classList.remove("show"),this.visible=!1)},this.addMenuItem=function(item,mark){var menuElem=document.createElement("span");item.id&&menuElem.setAttribute("id",item.id),menuElem.classList.add("stree-ctxmenu-item"),mark&&menuElem.classList.add("mark"),item.label&&(menuElem.innerHTML=item.label),isFunction(item.onclick)&&menuElem.addEventListener("click",this.onMenuclick(this,item.onclick)),this.menuEl.appendChild(menuElem)},this.addLineItem=function(mark){var lineElem=document.createElement("span");lineElem.classList.add("stree-ctxmenu-line"),mark&&lineElem.classList.add("mark"),lineElem.innerHTML="&nbsp;",this.menuEl.appendChild(lineElem)},this.addItem=function(item){item.line?this.addLineItem():this.addMenuItem(item)},this.createMenu=function(){var menuElem=document.createElement("div");menuElem.setAttribute("id",this.menu.id),menuElem.classList.add("stree-ctxmenu"),this.menuEl=menuElem;var items=this.menu.items;if(items&&items.length>0)for(var itemIdx=0;itemIdx<items.length;itemIdx++)this.addItem(items[itemIdx]);else this.menu.items=[];document.body.appendChild(menuElem),window.addEventListener("click",this.windowClickListener(this)),window.addEventListener("contextmenu",this.windowClickListener(this))},this.refreshMenu=function(override,items){var mark=!1;if(override)this.menuEl.innerHTML="",mark=!0;else{for(var markedElems=this.menuEl.querySelectorAll(".mark"),mIdx=0;mIdx<markedElems.length;mIdx++)this.menuEl.removeChild(markedElems[mIdx]);for(var orgItems=[],iIdx=0;iIdx<this.menu.items.length;iIdx++){var item;(item=this.menu.items[iIdx]).mark||orgItems.push(item)}this.menu.items=orgItems,items&&items.length>0?(this.menu.items.length>0&&(this.addLineItem(!0),this.menu.items.push({line:!0,mark:!0})),mark=!0):(this.menuEl.innerHTML="",items=this.menu.items,this.menu.items=[],mark=!1)}if(items&&items.length>0)for(var itemIdx=0;itemIdx<items.length;itemIdx++){var item;(item=items[itemIdx]).mark=mark,item.line?this.addLineItem(mark):this.addMenuItem(item,mark),this.menu.items.push(item)}},this.initMenu=function(){this.menu&&this.menu.id?this.createMenu():console.log("Invalid menu structure")},this.initMenu()},SMenu=function(container,menu,options){function isFunction(functionToCheck){return functionToCheck&&"[object Function]"==={}.toString.call(functionToCheck)}this.container=container,this.menu=menu,this.onMenuclick=function(menu,menuItem,menuClickHandler){return function(e){var eventObj={e:e,menu:menuItem};menuClickHandler.call(menu,eventObj)}},this.addMenuItem=function(item){var menuElem=document.createElement("span");item.id&&menuElem.setAttribute("id",item.id),menuElem.classList.add("menu-item"),item.label&&(menuElem.innerHTML=item.label),isFunction(item.onclick)&&menuElem.addEventListener("click",this.onMenuclick(this,item,item.onclick)),this.menuEl.appendChild(menuElem)},this.addLineItem=function(){var lineElem=document.createElement("span");lineElem.innerHTML="&nbsp;",lineElem.classList.add("menu-sep"),this.menuEl.appendChild(lineElem)},this.addItem=function(item){item.line?this.addLineItem():this.addMenuItem(item)},this.createMenu=function(){var menuElem=document.createElement("div");menuElem.setAttribute("id",this.menu.id),menuElem.classList.add("smenu"),this.menuEl=menuElem;var items=this.menu.items;if(items&&items.length>0)for(var itemIdx=0;itemIdx<items.length;itemIdx++)this.addItem(items[itemIdx]);else this.menu.items=[];this.container.appendChild(menuElem)},this.initMenu=function(){this.menu&&this.menu.id?this.createMenu():console.log("Invalid menu structure")},this.initMenu()},STabs=function(el,tabData,options){this.container=el,this.tabs=tabData,this.options=options,this.eventListeners={},this.TAB_HEADER_TAG="div",this.TAB_TITLE_BAR_TAG="div",this.TAB_PANE_TAG="div",this.TAB_TITLE_TAG="span",this.TAB_CONTENT_TAG="div",this.TAB_CLOSE_TAG="span",this.EVENT_TAB_ACTIVE="stabs-tab-active",this.EVENT_TAB_BLUR="stabs-tab-blur",this.EVENT_TAB_REMOVE="stabs-tab-remove",this.EVENT_TAB_ADD="stabs-tab-add",this.getNewId=function(length){var idPrefix;return(this.container.id?this.container.id+"-":"")+"stree-"+Math.round(Math.pow(36,length+1)-Math.random()*Math.pow(36,length)).toString(36).slice(1)},this.addEventListener=function(eventKey,listener){this.eventListeners[eventKey]||(this.eventListeners[eventKey]=[]),this.eventListeners[eventKey].push(listener)},this.sendEvent=function(eventKey,eventObj){var listeners=this.eventListeners[eventKey];if(listeners&&listeners.length>0)for(var lIdx=0;lIdx<listeners.length;lIdx++)listeners[lIdx].call(this,eventObj)},this.onTabBlur=function(tab){var eventObj={type:this.EVENT_TAB_BLUR,tab:tab};this.sendEvent(this.EVENT_TAB_BLUR,eventObj)},this.onTabActive=function(tab){var eventObj={type:this.EVENT_TAB_ACTIVE,tab:tab};this.sendEvent(this.EVENT_TAB_ACTIVE,eventObj)},this.onTabAdd=function(tab){var eventObj={type:this.EVENT_TAB_ADD,tab:tab};this.sendEvent(this.EVENT_TAB_ADD,eventObj)},this.onTabRemove=function(tab){var eventObj={type:this.EVENT_TAB_REMOVE,tab:tab};this.sendEvent(this.EVENT_TAB_REMOVE,eventObj)},this.hasTab=function(id){return null!=this.getTab(id)},this.getTab=function(id){for(var rVal=null,tIdx=0;tIdx<this.tabs.items.length;tIdx++){var tObj=this.tabs.items[tIdx];if(tObj.id===id){rVal=tObj;break}}return rVal},this.resetActiveTab=function(){this.activeTab&&(this.activeTab.titleEl.classList.remove("active"),this.activeTab.contentEl.classList.remove("active"),this.onTabBlur(this.activeTab))},this.setActiveTab=function(tab){this.activeTab&&this.resetActiveTab(),tab.titleEl.classList.add("active"),tab.contentEl.classList.add("active"),this.activeTab=tab,this.onTabActive(tab)},this.getOnTabSelectListener=function(tab,stabs){return function(e){e.srcElement.classList.contains("stabs-close")||stabs.setActiveTab.call(stabs,tab)}},this.removeAllTabs=function(){for(;this.tabs.items.length>0;)this.removeTab(this.tabs.items[this.tabs.items.length-1])},this.removeTab=function(tab){this.activeTab.id===tab.id&&this.resetActiveTab(),this.headerEl.removeChild(tab.titleEl),this.tabPaneEl.removeChild(tab.contentEl);for(var tIdx=0;tIdx<this.tabs.items.length;tIdx++){var tObj;if(this.tabs.items[tIdx].id===tab.id){this.tabs.items.splice(tIdx,1);var activIdx=tIdx>=this.tabs.items.length?this.tabs.items.length-1:tIdx;activIdx>=0&&this.setActiveTab(this.tabs.items[activIdx]);break}}this.onTabRemove(tab)},this.getOnTabCloseListener=function(tab,stabs){return function(e){stabs.removeTab.call(stabs,tab)}},this.createTabClose=function(tab){var closeElem=document.createElement(this.TAB_CLOSE_TAG);closeElem.classList.add("stabs-close"),closeElem.innerHTML="x",closeElem.addEventListener("click",this.getOnTabCloseListener(tab,this)),tab.titleEl.appendChild(closeElem)},this.createTabTitle=function(tab){var titleElem=document.createElement(this.TAB_TITLE_TAG);titleElem.classList.add("stabs-title"),(tab.default||tab.active)&&titleElem.classList.add("active"),tab.title&&(titleElem.setAttribute("title",tab.title),titleElem.innerHTML=tab.title),titleElem.addEventListener("click",this.getOnTabSelectListener(tab,this)),tab.titleEl=titleElem,tab.allowClose&&this.createTabClose(tab),this.headerEl.appendChild(titleElem)},this.createTabContent=function(tab){var contentElem=document.createElement(this.TAB_CONTENT_TAG);contentElem.classList.add("stabs-content"),(tab.default||tab.active)&&contentElem.classList.add("active"),tab.content&&(contentElem.innerHTML=tab.content),tab.contentEl=contentElem,this.tabPaneEl.appendChild(contentElem)},this.createTabItem=function(tab){tab.id||(tab.id=this.getNewId(5)),this.createTabTitle(tab),this.createTabContent(tab),(tab.default||tab.active)&&(this.activeTab=tab)},this.addTab=function(tab){if(!this.initTabs())return!1;this.tabs.items.push(tab),this.activeTab&&this.resetActiveTab(),this.createTabItem(tab),this.onTabAdd(tab)},this.createTabPane=function(){var tabPaneElem=document.createElement(this.TAB_PANE_TAG);tabPaneElem.classList.add("stabs-pane"),this.tabPaneEl=tabPaneElem,this.container.appendChild(tabPaneElem)},this.createTabHeader=function(){var tabHeaderElem=document.createElement(this.TAB_HEADER_TAG);tabHeaderElem.classList.add("stabs-header");var titleBarElem=document.createElement(this.TAB_TITLE_BAR_TAG);titleBarElem.classList.add("stabs-title-bar"),tabHeaderElem.appendChild(titleBarElem),this.headerEl=titleBarElem,this.container.appendChild(tabHeaderElem)},this.initTabs=function(){return!!this.tabs&&(this.tabs.items||(this.tabs.items=[]),this.headerEl&&this.tabPaneEl||(this.container.innerHTML="",this.createTabHeader(),this.createTabPane()),!0)},this.createTabs=function(){if(this.container.classList.add("stabs"),this.tabs&&this.tabs.items&&this.tabs.items.length>0){this.createTabHeader(),this.createTabPane();for(var tIdx=0;tIdx<this.tabs.items.length;tIdx++)this.createTabItem(this.tabs.items[tIdx])}},this.createTabs()},Icon={get:function(iconId){return Icon[iconId]},FILE_ICON:'<?xml version="1.0" encoding="iso-8859-1"?><svg class="sicon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" fill="#efefef" stroke="#dddddd"><path stroke-width="12px" d="M447.168,134.56c-0.537-1.284-1.319-2.451-2.304-3.435l-128-128c-2.002-1.991-4.707-3.114-7.531-3.125H74.667C68.776,0,64,4.776,64,10.667v490.667C64,507.224,68.776,512,74.667,512h362.667c5.891,0,10.667-4.776,10.667-10.667V138.667C447.997,137.256,447.714,135.86,447.168,134.56z"/></svg>',FOLDER_ICON:'<?xml version="1.0" encoding="iso-8859-1"?><svg class="sicon-svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 491.52 491.52" fill="#efefef" stroke="#dddddd"><path stroke-width="12px" d="M207.05,102.4l-53.53-51.2 H0v389.12h491.52 V102.4H207.05z"/><rect fill="#dddddd" x="194.56" y="368.64" width="235.52" height="20.48"/><rect fill="#dddddd" x="296.96" y="317.44" width="133.12" height="20.48"/></svg>'};